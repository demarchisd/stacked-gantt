/*! Stacked Gantt - v0.2.3 - 2018-09-29
* https://github.com/demarchisd/stacked-gantt
* Copyright (c) 2018 Bruno Kewitz Demarchi; Licensed MIT */

!function(re){"use strict";var ie=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],oe="No data to display.";function ae(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function n(r){var i,u,o,l,a,s,M,y,c,d,h,f,g,p,v,E,m,b,w,_,k,D,H,C,x,G,O,I,z,T,W,j,L;function S(e){if("[object Date]"===Object.prototype.toString.call(e))return e;if(!isNaN(e))return new Date(e);throw new Error("Invalid Date: "+e)}function A(i){return C.reduce(function(e,t){if(e)return e;var n=parseInt(t.css("left")),r=Math.ceil(n+t.outerWidth());return n<=i&&i<=r},!1)}function N(e,t,n,r){var i=re("<div>",{class:"sg_date_header_item "+(n?"scroll ":"")+(r?"conflict ":""),css:{minWidth:f+"px",left:(t?f*t:n)+"px"}});return a.append(i),i.html(k(e)),i}function R(e,t,n){var r=X(e),i=e.description,o=n;Y(t,r,i,V(e.when,!0),i[0],o,!0)}function B(e){var t,n=U(e),r=parseInt(q())*y.length+"px",i=X(e),o=$(e.when,M.begin),a=void 0!==(t=e).onClick?t.onClick:L,s=re("<div>",{class:"sg_general_marker",css:{width:n,height:r,left:o,backgroundColor:i}});u.append(s),a&&(s.click(function(){a(e,y)}),s.css("cursor","pointer")),R(e,s)}function F(e){var t,n=$(e.begin,e.end),r=parseInt(q())*y.length+"px",i=(t=e).color?t.color:"#e0a00e",o=$(e.begin,M.begin),a=re("<div>",{class:"sg_general_highlight",css:{width:n,height:r,left:o,backgroundColor:i}});u.append(a)}function $(e,t){var n=60*Math.abs(e.getTimezoneOffset()-t.getTimezoneOffset())*1e3;return(Math.abs(e-t)-n)/36e5*f+"px"}function q(){return v&&v.rowHeight?v.rowHeight:"50px"}function Q(e){if(e.color)return e.color;var t=E[e.code];return t&&t.color?t.color:"#7fad7f"}function U(e){return e.width?e.width:"3px"}function X(e){return e.color?e.color:"#e0a00e"}function Y(o,a,s,c,u,l,d){var h=function(e){o.addClass("hover");var t,n=re("<div>",{class:"sg_tooltip"}),r=("#"===(t=a)[0]&&(t=ae(t)),.2126*t.r+.7152*t.g+.0722*t.b<170?"#fff":"#585050");!function(a,e,t,n,r,i,o,s){if(n){var c=re("<div>",{class:"sg_tooltip_badge",html:n,css:{backgroundColor:i,color:o}});s&&c.addClass("square"),a.append(c)}var u=re("<span>",{class:"sg_tooltip_title",html:e});if(a.append(u),r){var l=re("<span>",{class:"sg_tooltip_subtitle",html:r});a.append(l)}t&&(t.constructor!==Array&&(t=[t]),t.forEach(function(e){var t,n;n="string"==typeof e?e:(t=e.title,e.description);var r=re("<div>",{class:"sg_tooltip_description_wrapper"}),i=re("<div>",{class:"sg_tooltip_description"});if(r.append(i),t){var o=re("<span>",{class:"sg_tooltip_description_title",html:t});i.append(o)}i.append(n),a.append(r)}))}(n,s,c,u,l,a,r,d);var i=function(e,t){var n=re(window),r=e.pageX+5,i=e.pageY+5,o=te(t).width,a=r+o,s=n.scrollLeft()+n.width();s-50<=a&&(r-=a-s+50);var c=te(t).height,u=i+c,l=n.scrollTop()+n.height();l-75<=u&&(i-=u-l+75);return{left:r,top:i}}(e,n);i.position="absolute",i.borderColor=a,n.css(i),n.mouseover(K(n)),n.mouseout(J(o,n,h)),o.unbind("mouseover mouseout"),o.mouseover(K(n)),o.mouseout(J(o,n,h)),ne().append(n)};o.mouseover(h)}function J(e,t,n){return function(){t.shallRemove=!0,setTimeout(function(){t.shallRemove&&(t.remove(),e.unbind("mouseover mouseout"),e.removeClass("hover"),e.mouseover(n))},50)}}function K(e){return function(){e.shallRemove=!1}}function P(){t("inline-block","inline-block");var e=i.outerWidth();r.width()<=e&&t("block","grid")}function t(e,t){i.css("display",""),u.css("display",""),i.css("display",e),u.css("display",t)}function V(e,t){var n="";return t&&(n=Z(e)+" "),n+=ee(e)}this.update=function(e,t,n){y=e,c=t||[],d=n||[],this.clearGraphicElements(),this.build()},this.clearOptions=function(){_=!(w=L=j=W=m=E=v=p=g=f=h=d=c=y=M=null),T=z=I=O=G=x=C=H=k=null},this.clearGraphicElements=function(){r.empty()},this.config=function(e){var t;(t=e.data).forEach(function(e){e.thresholds&&e.thresholds.forEach(function(e){e.begin=S(e.begin),e.end=S(e.end)}),e.markers&&e.markers.forEach(function(e){e.when=S(e.when)}),e.activities.forEach(function(e){e.begin=S(e.begin),e.end=S(e.end)})}),y=t,c=function(e){if(!e)return;return e.forEach(function(e){e.when=S(e.when)}),e}(e.generalMarkers?e.generalMarkers:[]),d=function(e){if(!e)return;return e.forEach(function(e){e.begin=S(e.begin),e.end=S(e.end)}),e}(e.generalHighlights?e.generalHighlights:[]),(v=e.style)?(h=v.descriptionContainerWidth?v.descriptionContainerWidth:"250px",E=v.activityStyle?v.activityStyle:{},f=v.hourWidth?v.hourWidth:80,m=v.months?v.months:ie,w=v.showDateOnHeader,D=v.noDataText?v.noDataText:oe,x=v.defaultBeginDate?v.defaultBeginDate:new Date((new Date).setHours(1)).setMinutes(0),G=v.defaultEndDate?v.defaultEndDate:new Date((new Date).setHours(23)).setMinutes(0),O=v.beginDate,I=v.endDate,z=!1!==v.autoAdjustLimits,void 0!==v.showTimeOnHeader&&(_=v.showTimeOnHeader),v.formatHour&&(ee=v.formatHour),v.formatDate&&(Z=v.formatDate),k=v.dateHeaderFormat?v.dateHeaderFormat:Z):(E={},f=80,m=ie,k=Z,D=oe);var n=e.events;n&&(W=n.onActivityClick,j=n.onMarkerClick,L=n.onGeneralMarkerClick)},this.zoomIn=function(){f*=1.1,this.clearGraphicElements(),this.build()},this.zoomOut=function(){f*=.9,this.clearGraphicElements(),this.build()},this.destroy=function(){this.clearGraphicElements(),delete r.update,delete r.zoomIn,delete r.zoomOut,delete r.destroy,delete r.stackedGantt},this.getData=function(){return y},this.getGeneralMarkers=function(){return c},this.getGeneralHighlights=function(){return d},this.build=function(){var e,t,n;y&&y.length?(!function(){var e=r[0].clientHeight;e=e?e-30*(!0===w)-30*(!0===_)-20:void 0;var t=re("<div>",{class:"sg_container_wrapper"});r.append(t),i=re("<div>",{class:"sg_container"}),t.append(i),o=re("<div>",{class:"sg_header_container",css:{"margin-left":h}}),i.append(o),l=re("<div>",{class:"sg_desc_container",css:{height:e||void 0,width:h}}),i.append(l),u=re("<div>",{class:"sg_val_container",css:{height:e||void 0}}),i.append(u),n=u,n.bind("mousewheel DOMMouseScroll",function(e){(e=window.event||e).wheelDelta||e.detail||(e=e.originalEvent);var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));n.scrollLeft(n.scrollLeft()-40*t),e.preventDefault()}),w&&u.scroll(function(){H&&(H.remove(),H=null);var e=u.scrollLeft();o.scrollLeft(e);var t=A(e),n=Math.floor(e/f),r=p[n];H=N(r,null,e,t)});var n;l.scroll(function(){u.scrollTop(l.scrollTop())})}(),function(){var e,t,n=y.map(function(e){return{begin:function(e){var t=[];e.activities&&(t=t.concat(e.activities.map(function(e){return e.begin})));e.markers&&(t=t.concat(e.markers.map(function(e){return e.when})));e.thresholds&&(t=t.concat(e.thresholds.map(function(e){return e.begin})));if(!t.length)return;return t.reduce(function(e,t){return t<e?t:e})}(e),end:function(e){var t=[];e.activities&&(t=t.concat(e.activities.map(function(e){return e.end})));e.markers&&(t=t.concat(e.markers.map(function(e){return e.when})));e.thresholds&&(t=t.concat(e.thresholds.map(function(e){return e.end})));I&&t.push(I);if(!t.length)return;return t.reduce(function(e,t){return e<t?t:e})}(e)}}),r=n.map(function(e){return e.begin}).filter(function(e){return e}).concat(c.map(function(e){return e.when})).concat(d.map(function(e){return e.begin}));O&&r.push(O);e=r.length?new Date(r.reduce(function(e,t){return t<e?t:e})):new Date(x);!O&&z&&(e.getMinutes()<=10||50<=e.getMinutes())&&e.setHours(e.getHours()-1);e.setMinutes(0);var i=n.map(function(e){return e.end}).filter(function(e){return e}).concat(c.map(function(e){return e.when})).concat(d.map(function(e){return e.end}));I&&i.push(I);t=i.length?new Date(i.reduce(function(e,t){return e<t?t:e})):new Date(G);!I&&z&&(t.getMinutes()<=10||50<=t.getMinutes())&&t.setHours(t.getHours()+1);t.setMinutes(0),M={begin:e,end:t}}(),function(){w&&(C=[],a=re("<div>",{class:"sg_date_header_container"}),o.append(a));s=re("<div>",{class:"sg_time_header_container"}),o.append(s),p=function(){for(var e=[],t=new Date(M.begin);t<=M.end;t.setHours(t.getHours()+1))e.push(new Date(t));return e}(),g=p.length,p.forEach(function(e,t){var n,r;_&&(n=e,r=re("<div>",{class:"sg_time_header_item",css:{width:f+"px"}}),s.append(r),r.html(ee(n)),w&&r.attr("title",k(n))),!w||0!==t&&0!==e.getHours()||A(f*t)||C.push(N(e,t))})}(),e=C[C.length-1],t=Math.ceil(parseInt(e.css("left"))+e.outerWidth())+12,T=Math.max(g*f,t),y.forEach(function(e,t){var n,r,i,o,D,a,s,H,c=t%2==0;n=e,r=c,i=q(),o=re("<div>",{class:"sg_row_desc_container "+(r?"even":"odd"),css:{height:i,lineHeight:i}}),l.append(o),o.html(n.description),D=e,a=c,s=q(),H=re("<div>",{class:"sg_row_val_container "+(a?"even":"odd"),css:{height:s,lineHeight:s,width:T}}),u.append(H),D.activities.forEach(function(e){var t,n,r,i,o,a,s,c,u,l,d,h,f,g,p,v,m,b,w,_,k;n=H,r=D,v=$((t=e).begin,t.end),m=$(t.begin,M.begin),b=Q(t),w=function(e){if(e.height)return e.height;var t=E[e.code];return t&&t.height?t.height:"20px"}(t),_=void 0!==(i=t).onClick?i.onClick:W,k=re("<div>",{class:"sg_activity",css:{width:v,left:m,backgroundColor:b,height:w}}),n.append(k),_&&(k.click(function(){_(t,r,y)}),k.css("cursor","pointer")),o=t,a=k,s=r.description,c=Q(o),u=o.description,l=s,d=V((f=o).begin,!0)+" â€” "+V(f.end,(g=f.begin,p=f.end,g=new Date(g).setHours(0,0,0,0),p=new Date(p).setHours(0,0,0,0),!(g===p))),h=u[0],Y(a,c,u,d,h,l)}),D.thresholds&&D.thresholds.forEach(function(e){!function(e,t){if(e&&e.begin&&e.end){var n,r,i,o,a=(i=ae((r=e).color?r.color:v&&v.thresholdColor?v.thresholdColor:"#000000"),o=.3,"rgba("+i.r+","+i.g+","+i.b+","+o+")"),s=(n=e).height?n.height:v&&v.thresholdHeight?v.thresholdHeight:"20px",c=$(e.begin,e.end),u=$(e.begin,M.begin),l={backgroundColor:a},d=re("<div>",{class:"sg_threshold",css:{width:c,left:u,height:s}});t.append(d);var h=re("<div>",{class:"sg_threshold_limit begin",css:l});d.append(h);var f=re("<div>",{class:"sg_threshold_line",css:l});d.append(f);var g=re("<div>",{class:"sg_threshold_limit end",css:l});d.append(g)}}(e,H)}),D.markers&&D.markers.forEach(function(e){var t,n,r,i,o,a,s,c,u,l,d;n=H,r=D,a=U(t=e),s=(o=t).height?o.height:"30px",c=X(t),u=$(t.when,M.begin),l=void 0!==(i=t).onClick?i.onClick:j,d=re("<div>",{class:"sg_marker",css:{width:a,height:s,left:u,backgroundColor:c}}),n.append(d),l&&(d.click(function(){l(t,r,y)}),d.css("cursor","pointer")),R(t,d,r.description)})}),function(){if(!c.length)return;c.forEach(B)}(),function(){if(!d.length)return;d.forEach(F)}(),P(),b||(b=!0,re(window).on("resize",P))):(n=re("<div>",{class:"sg_no_data",html:D}),r.append(n))};var Z=function(e){var t=e.getDate();return(t=("0"+t).slice(-2))+"/"+m[e.getMonth()]},ee=function(e){var t=e.getHours();t=("0"+t).slice(-2);var n=e.getMinutes();return t+":"+(n=("0"+n).slice(-2))};function te(e){var t=e.clone().show().css("visibility","hidden");ne().append(t);var n={width:t.width(),height:t.height()};return t.remove(),n}function ne(){var e=i.parentsUntil("body").last().parent();return re(e)}}re.fn.stackedGantt=function(e){var t=re(this),r=new n(t);return(t.stackedGantt=r).clearOptions(),r.clearGraphicElements(),r.config(e),r.build(),t.update=function(e,t,n){r.update(e,t,n)},t.zoomIn=function(){r.zoomIn()},t.zoomOut=function(){r.zoomOut()},t.destroy=function(){r.destroy()},t.getData=function(){return r.getData()},t.getGeneralMarkers=function(){return r.getGeneralMarkers()},t.getGeneralHighlights=function(){return r.getGeneralHighlights()},t}}(jQuery);