/*! Stacked Gantt - v0.2.3 - 2018-05-17
* https://github.com/demarchisd/stacked-gantt
* Copyright (c) 2018 Bruno Kewitz Demarchi; Licensed MIT */

!function(n){"use strict";function e(n){return"#"===n[0]&&(n=t(n)),.2126*n.r+.7152*n.g+.0722*n.b<170?"#fff":"#585050"}function t(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,e,t,r){return e+e+t+t+r+r});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function r(n,e){return"rgba("+n.r+","+n.g+","+n.b+","+e+")"}function i(n){var e=function(e){(e=window.event||e).wheelDelta||e.detail||(e=e.originalEvent);var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));n.scrollLeft(n.scrollLeft()-40*t),e.preventDefault()};n.bind("mousewheel DOMMouseScroll",e)}function o(o){function b(n){return n.forEach(function(n){n.thresholds&&n.thresholds.forEach(function(n){n.begin=H(n.begin),n.end=H(n.end)}),n.markers&&n.markers.forEach(function(n){n.when=H(n.when)}),n.activities.forEach(function(n){n.begin=H(n.begin),n.end=H(n.end)})}),n}function k(n){if(n)return n.forEach(function(n){n.when=H(n.when)}),n}function D(n){if(n)return n.forEach(function(n){n.begin=H(n.begin),n.end=H(n.end)}),n}function H(n){if("[object Date]"===Object.prototype.toString.call(n))return n;if(!isNaN(n))return new Date(n);throw new Error("Invalid Date: "+n)}function M(){var e=n("<div>",{class:"sg_no_data",html:Fn});o.append(e)}function y(){var e=n("<div>",{class:"sg_container_wrapper"});o.append(e),Dn=n("<div>",{class:"sg_container"}),e.append(Dn),Mn=n("<div>",{class:"sg_desc_container "+bn(),css:{width:In}}),Dn.append(Mn),Hn=n("<div>",{class:"sg_val_container"}),Dn.append(Hn),i(Hn),Nn&&E()}function E(){Hn.scroll(function(){$n&&($n.remove(),$n=null);var n=Hn.scrollLeft(),e=C(n),t=Math.floor(n/zn),r=Wn[t];$n=z(r,null,n,e)})}function C(n){return qn.reduce(function(e,t){if(e)return e;var r=parseInt(t.css("left")),i=Math.ceil(r+t.outerWidth());return n>=r&&n<=i},!1)}function x(){var n,e=xn.map(function(n){return{begin:G(n),end:O(n)}}),t=e.map(function(n){return n.begin}).filter(function(n){return n}).concat(Gn.map(function(n){return n.when})).concat(On.map(function(n){return n.begin}));Xn&&t.push(Xn),n=t.length?new Date(t.reduce(function(n,e){return e<n?e:n})):new Date(Qn),!Xn&&Jn&&(n.getMinutes()<=10||n.getMinutes()>=50)&&n.setHours(n.getHours()-1),n.setMinutes(0);var r,i=e.map(function(n){return n.end}).filter(function(n){return n}).concat(Gn.map(function(n){return n.when})).concat(On.map(function(n){return n.end}));Yn&&i.push(Yn),r=i.length?new Date(i.reduce(function(n,e){return e>n?e:n})):new Date(Un),!Yn&&Jn&&(r.getMinutes()<=10||r.getMinutes()>=50)&&r.setHours(r.getHours()+1),r.setMinutes(0),Cn={begin:n,end:r}}function G(n){var e=[];if(n.activities&&(e=e.concat(n.activities.map(function(n){return n.begin}))),n.markers&&(e=e.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(e=e.concat(n.thresholds.map(function(n){return n.begin}))),e.length)return e.reduce(function(n,e){return e<n?e:n})}function O(n){var e=[];if(n.activities&&(e=e.concat(n.activities.map(function(n){return n.end}))),n.markers&&(e=e.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(e=e.concat(n.thresholds.map(function(n){return n.end}))),Yn&&e.push(Yn),e.length)return e.reduce(function(n,e){return e>n?e:n})}function I(){Nn&&(qn=[],yn=n("<div>",{class:"sg_date_header_container"}),Hn.append(yn)),En=n("<div>",{class:"sg_time_header_container"}),Hn.append(En),Wn=W(),Tn=Wn.length,Wn.forEach(function(n,e){Rn&&T(n),!Nn||0!==e&&0!==n.getHours()||C(zn*e)||qn.push(z(n,e))})}function z(e,t,r,i){var o={minWidth:zn+"px",left:(t?zn*t:r)+"px"},a=n("<div>",{class:"sg_date_header_item "+(r?"scroll ":"")+(i?"conflict ":""),css:o});return yn.append(a),a.html(Bn(e)),a}function T(e){var t=n("<div>",{class:"sg_time_header_item",css:{width:zn+"px"}});En.append(t),t.html(ee(e)),Nn&&t.attr("title",Bn(e))}function W(){for(var n=[],e=new Date(Cn.begin);e<=Cn.end;e.setHours(e.getHours()+1))n.push(new Date(e));return n}function j(){var n=qn[qn.length-1],e=Math.ceil(parseInt(n.css("left"))+n.outerWidth())+12;Kn=Math.max(Tn*zn,e),xn.forEach(function(n,e){var t=e%2==0;L(n,t),S(n,t)})}function L(e,t){var r=K(),i={height:r,lineHeight:r},o=n("<div>",{class:"sg_row_desc_container "+(t?"even":"odd"),css:i});Mn.append(o),o.html(e.description)}function S(e,t){var r=K(),i={height:r,lineHeight:r,width:Kn},o=n("<div>",{class:"sg_row_val_container "+(t?"even":"odd"),css:i});Hn.append(o),e.activities.forEach(function(n){F(n,o,e)}),e.thresholds&&e.thresholds.forEach(function(n){A(n,o)}),e.markers&&e.markers.forEach(function(n){N(n,o,e)})}function A(e,i){if(e&&e.begin&&e.end){var o=_,a=r(t(nn(e)),o),s=en(e),c=J(e.begin,e.end),u=J(e.begin,Cn.begin),l={backgroundColor:a},d=n("<div>",{class:"sg_threshold",css:{width:c,left:u,height:s}});i.append(d);var h=n("<div>",{class:"sg_threshold_limit begin",css:l});d.append(h);var f=n("<div>",{class:"sg_threshold_line",css:l});d.append(f);var g=n("<div>",{class:"sg_threshold_limit end",css:l});d.append(g)}}function N(e,t,r){var i=tn(e),o=rn(e),a=on(e),s=J(e.when,Cn.begin),c=an(e),u=n("<div>",{class:"sg_marker",css:{width:i,height:o,left:s,backgroundColor:a}});t.append(u),c&&(u.click(function(){c(e,r,xn)}),u.css("cursor","pointer")),R(e,u,r.description)}function R(n,e,t){var r=on(n),i=n.description,o=t;un(e,r,i,B(n),i[0],o,!0)}function B(n){return mn(n.when,!0)}function F(e,t,r){var i=J(e.begin,e.end),o=J(e.begin,Cn.begin),a=P(e),s=V(e),c=Z(e),u=n("<div>",{class:"sg_activity",css:{width:i,left:o,backgroundColor:a,height:s}});t.append(u),c&&(u.click(function(){c(e,r,xn)}),u.css("cursor","pointer")),$(e,u,r.description)}function $(n,e,t){var r=P(n),i=n.description,o=t;un(e,r,i,q(n),i[0],o)}function q(n){return mn(n.begin,!0)+" â€” "+mn(n.end,!wn(n.begin,n.end))}function Q(){Gn.length&&Gn.forEach(U)}function U(e){var t=tn(e),r=parseInt(K())*xn.length+"px",i=on(e),o=J(e.when,Cn.begin),a=sn(e),s={width:t,height:r,left:o,backgroundColor:i},c=n("<div>",{class:"sg_general_marker "+bn(),css:s});Hn.append(c),a&&(c.click(function(){a(e,xn)}),c.css("cursor","pointer")),R(e,c)}function X(){On.length&&On.forEach(Y)}function Y(e){var t=J(e.begin,e.end),r=parseInt(K())*xn.length+"px",i=cn(e),o={width:t,height:r,left:J(e.begin,Cn.begin),backgroundColor:i},a=n("<div>",{class:"sg_general_highlight "+bn(),css:o});Hn.append(a)}function J(n,e){var t=60*Math.abs(n.getTimezoneOffset()-e.getTimezoneOffset())*1e3;return(Math.abs(n-e)-t)/36e5*zn+"px"}function K(){return jn&&jn.rowHeight?jn.rowHeight:l}function P(n){if(n.color)return n.color;var e=Ln[n.code];return e&&e.color?e.color:c}function V(n){if(n.height)return n.height;var e=Ln[n.code];return e&&e.height?e.height:u}function Z(n){return void 0!==n.onClick?n.onClick:Pn}function nn(n){return n.color?n.color:jn&&jn.thresholdColor?jn.thresholdColor:w}function en(n){return n.height?n.height:jn&&jn.thresholdHeight?jn.thresholdHeight:m}function tn(n){return n.width?n.width:h}function rn(n){return n.height?n.height:d}function on(n){return n.color?n.color:f}function an(n){return void 0!==n.onClick?n.onClick:Vn}function sn(n){return void 0!==n.onClick?n.onClick:Zn}function cn(n){return n.color?n.color:g}function un(t,r,i,o,a,s,c){var u=function(l){t.addClass("hover");var d=n("<div>",{class:"sg_tooltip"}),h=e(r);dn(d,i,o,a,s,r,h,c);var f=ln(l,d);f.position="absolute",f.borderColor=r,d.css(f),d.mouseover(fn(d)),d.mouseout(hn(t,d,u)),t.unbind("mouseover mouseout"),t.mouseover(fn(d)),t.mouseout(hn(t,d,u)),kn().append(d)};t.mouseover(u)}function ln(e,t){var r=n(window),i=e.pageX+5,o=e.pageY+5,a=i+_n(t).width,s=r.scrollLeft()+r.width();a>=s-50&&(i-=a-s+50);var c=o+_n(t).height,u=r.scrollTop()+r.height();return c>=u-75&&(o-=c-u+75),{left:i,top:o}}function dn(e,t,r,i,o,a,s,c){if(i){var u=n("<div>",{class:"sg_tooltip_badge",html:i,css:{backgroundColor:a,color:s}});c&&u.addClass("square"),e.append(u)}var l=n("<span>",{class:"sg_tooltip_title",html:t});if(e.append(l),o){var d=n("<span>",{class:"sg_tooltip_subtitle",html:o});e.append(d)}r&&(r.constructor!==Array&&(r=[r]),r.forEach(function(t){var r,i;"string"==typeof t?i=t:(r=t.title,i=t.description);var o=n("<div>",{class:"sg_tooltip_description_wrapper"}),a=n("<div>",{class:"sg_tooltip_description"});if(o.append(a),r){var s=n("<span>",{class:"sg_tooltip_description_title",html:r});a.append(s)}a.append(i),e.append(o)}))}function hn(n,e,t){return function(){e.shallRemove=!0,setTimeout(function(){e.shallRemove&&(e.remove(),n.unbind("mouseover mouseout"),n.removeClass("hover"),n.mouseover(t))},50)}}function fn(n){return function(){n.shallRemove=!1}}function gn(){pn(),An||(An=!0,n(window).on("resize",pn))}function pn(){vn("inline-block","inline-block"),Dn.outerWidth()>=o.width()&&vn("block","grid")}function vn(n,e){Dn.css("display",""),Hn.css("display",""),Dn.css("display",n),Hn.css("display",e)}function mn(n,e){var t="";return e&&(t=ne(n)+" "),t+=ee(n)}function wn(n,e){return n=new Date(n).setHours(0,0,0,0),e=new Date(e).setHours(0,0,0,0),n===e}function _n(n){var e=n.clone().show().css("visibility","hidden");kn().append(e);var t={width:e.width(),height:e.height()};return e.remove(),t}function bn(){var n="with_datetime_header";return Nn||Rn?Nn?Rn||(n="with_date_header"):n="with_time_header":n="without_header",n}function kn(){var e=Dn.parentsUntil("body").last().parent();return n(e)}var Dn,Hn,Mn,yn,En,Cn,xn,Gn,On,In,zn,Tn,Wn,jn,Ln,Sn,An,Nn,Rn,Bn,Fn,$n,qn,Qn,Un,Xn,Yn,Jn,Kn,Pn,Vn,Zn;this.update=function(n,e,t){xn=n,Gn=e||[],On=t||[],this.clearGraphicElements(),this.build()},this.clearOptions=function(){Cn=null,xn=null,Gn=null,On=null,In=null,zn=null,Tn=null,Wn=null,jn=null,Ln=null,Sn=null,Pn=null,Vn=null,Zn=null,Nn=null,Rn=!0,Bn=null,$n=null,qn=null,Qn=null,Un=null,Xn=null,Yn=null,Jn=null,Kn=null},this.clearGraphicElements=function(){o.empty()},this.config=function(n){xn=b(n.data),Gn=k(n.generalMarkers?n.generalMarkers:[]),On=D(n.generalHighlights?n.generalHighlights:[]),(jn=n.style)?(In=jn.descriptionContainerWidth?jn.descriptionContainerWidth:a,Ln=jn.activityStyle?jn.activityStyle:{},zn=jn.hourWidth?jn.hourWidth:s,Sn=jn.months?jn.months:p,Nn=jn.showDateOnHeader,Fn=jn.noDataText?jn.noDataText:v,Qn=jn.defaultBeginDate?jn.defaultBeginDate:new Date((new Date).setHours(1)).setMinutes(0),Un=jn.defaultEndDate?jn.defaultEndDate:new Date((new Date).setHours(23)).setMinutes(0),Xn=jn.beginDate,Yn=jn.endDate,Jn=!1!==jn.autoAdjustLimits,void 0!==jn.showTimeOnHeader&&(Rn=jn.showTimeOnHeader),jn.formatHour&&(ee=jn.formatHour),jn.formatDate&&(ne=jn.formatDate),Bn=jn.dateHeaderFormat?jn.dateHeaderFormat:ne):(Ln={},zn=s,Sn=p,Bn=ne,Fn=v);var e=n.events;e&&(Pn=e.onActivityClick,Vn=e.onMarkerClick,Zn=e.onGeneralMarkerClick)},this.zoomIn=function(){zn*=1.1,this.clearGraphicElements(),this.build()},this.zoomOut=function(){zn*=.9,this.clearGraphicElements(),this.build()},this.destroy=function(){this.clearGraphicElements(),delete o.update,delete o.zoomIn,delete o.zoomOut,delete o.destroy,delete o.stackedGantt},this.getData=function(){return xn},this.getGeneralMarkers=function(){return Gn},this.getGeneralHighlights=function(){return On},this.build=function(){xn&&xn.length?(y(),x(),I(),j(),Q(),X(),gn()):M()};var ne=function(n){var e=n.getDate();return(e=("0"+e).slice(-2))+"/"+Sn[n.getMonth()]},ee=function(n){var e=n.getHours();e=("0"+e).slice(-2);var t=n.getMinutes();return t=("0"+t).slice(-2),e+":"+t}}var a="250px",s=80,c="#7fad7f",u="20px",l="50px",d="30px",h="3px",f="#e0a00e",g="#e0a00e",p=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],v="No data to display.",m="20px",w="#000000",_=.3;n.fn.stackedGantt=function(e){var t=n(this),r=new o(t);return t.stackedGantt=r,r.clearOptions(),r.clearGraphicElements(),r.config(e),r.build(),t.update=function(n,e,t){r.update(n,e,t)},t.zoomIn=function(){r.zoomIn()},t.zoomOut=function(){r.zoomOut()},t.destroy=function(){r.destroy()},t.getData=function(){return r.getData()},t.getGeneralMarkers=function(){return r.getGeneralMarkers()},t.getGeneralHighlights=function(){return r.getGeneralHighlights()},t}}(jQuery);