/*! Stacked Gantt - v0.1.0 - 2017-05-16
* https://github.com/demarchisd/stacked-gantt
* Copyright (c) 2017 Bruno Kewitz Demarchi; Licensed MIT */

!function(n){"use strict";function e(n){return"#"===n[0]&&(n=t(n)),.2126*n.r+.7152*n.g+.0722*n.b<170?"#fff":"#585050"}function t(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,e,t,r){return e+e+t+t+r+r});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function r(n){var e=function(e){(e=window.event||e).wheelDelta||e.detail||(e=e.originalEvent);var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));n.scrollLeft(n.scrollLeft()-40*t),e.preventDefault()};n.bind("mousewheel DOMMouseScroll",e)}function i(t){function i(n){return n.forEach(function(n){n.thresholds&&n.thresholds.forEach(function(n){n.begin=g(n.begin),n.end=g(n.end)}),n.markers&&n.markers.forEach(function(n){n.when=g(n.when)}),n.activities.forEach(function(n){n.begin=g(n.begin),n.end=g(n.end)})}),n}function v(n){if(n)return n.forEach(function(n){n.when=g(n.when)}),n}function g(n){if("[object Date]"===Object.prototype.toString.call(n))return n;if(!isNaN(n))return new Date(n);throw new Error("Invalid Date: "+n)}function m(){var e=n("<div>",{class:"sg_no_data",html:Mn});t.append(e)}function w(){var e=n("<div>",{class:"sg_container_wrapper"});t.append(e),sn=n("<div>",{class:"sg_container"}),e.append(sn),ln=n("<div>",{class:"sg_desc_container "+(Dn?"with_datetime_header":"with_time_header"),css:{width:gn}}),sn.append(ln),un=n("<div>",{class:"sg_val_container"}),sn.append(un),r(un),Dn&&_()}function _(){un.scroll(function(){En&&(En.remove(),En=null);var n=un.scrollLeft(),e=b(n),t=Math.floor(n/mn),r=_n[t];En=H(r,null,n,e)})}function b(n){return xn.reduce(function(e,t){if(e)return e;var r=parseInt(t.css("left")),i=Math.ceil(r+t.outerWidth());return n>=r&&n<=i},!1)}function k(){var n=pn.map(function(n){return{begin:y(n),end:C(n)}}),e=new Date(n.map(function(n){return n.begin}).concat(vn.map(function(n){return n.when})).reduce(function(n,e){return e<n?e:n}));e.getMinutes()<=10&&e.setHours(e.getHours()-1),e.setMinutes(0);var t=new Date(n.map(function(n){return n.end}).concat(vn.map(function(n){return n.when})).reduce(function(n,e){return e>n?e:n}));t.getMinutes()>=50&&t.setHours(t.getHours()+1),t.setMinutes(0),fn={begin:e,end:t}}function y(n){var e=n.activities.map(function(n){return n.begin});return n.markers&&(e=e.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(e=e.concat(n.thresholds.map(function(n){return n.begin}))),e.reduce(function(n,e){return e<n?e:n})}function C(n){var e=n.activities.map(function(n){return n.end});return n.markers&&(e=e.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(e=e.concat(n.thresholds.map(function(n){return n.end}))),e.reduce(function(n,e){return e>n?e:n})}function D(){Dn&&(xn=[],dn=n("<div>",{class:"sg_date_header_container"}),un.append(dn)),hn=n("<div>",{class:"sg_time_header_container"}),un.append(hn),_n=E(),wn=_n.length,_n.forEach(function(n,e){M(n),Dn&&(0!==e&&0!==n.getHours()||xn.push(H(n,e)))})}function H(e,t,r,i){var o={minWidth:mn+"px",left:(t?mn*t:r)+"px"},a=n("<div>",{class:"sg_date_header_item "+(r?"scroll ":"")+(i?"conflict ":""),css:o});return dn.append(a),a.html(Hn(e)),a}function M(e){var t=n("<div>",{class:"sg_time_header_item",css:{width:mn+"px"}});hn.append(t),t.html(On(e)),Dn&&t.attr("title",Hn(e))}function E(){for(var n=[],e=new Date(fn.begin);e<=fn.end;e.setHours(e.getHours()+1))n.push(new Date(e));return n}function x(){pn.forEach(function(n,e){var t=e%2==0;W(n,t),j(n,t)})}function W(e,t){var r=q(),i={height:r,lineHeight:r},o=n("<div>",{class:"sg_row_desc_container "+(t?"even":"odd"),css:i});ln.append(o),o.html(e.description)}function j(e,t){var r=q(),i={height:r,lineHeight:r,width:wn*mn},o=n("<div>",{class:"sg_row_val_container "+(t?"even":"odd"),css:i});un.append(o),e.activities.forEach(function(n){S(n,o,e)}),e.thresholds&&e.thresholds.forEach(function(n){G(n,o)}),e.markers&&e.markers.forEach(function(n){I(n,o,e)})}function G(e,t){if(e&&e.begin&&e.end){var r=$(e.begin,e.end),i=$(e.begin,fn.begin),o=n("<div>",{class:"sg_threshold",css:{width:r,left:i}});t.append(o)}}function I(e,t,r){var i=X(e),o=Y(e),a=B(e),c=$(e.when,fn.begin),s=J(e),u=n("<div>",{class:"sg_marker",css:{width:i,height:o,left:c,backgroundColor:a}});t.append(u),s&&(u.click(function(){s(e,r,pn)}),u.css("cursor","pointer")),O(e,u,r.description)}function O(n,e,t){var r=B(n),i=n.description,o=t;P(e,r,i,L(n),i[0],o,!0)}function L(n){return on(n.when,!0)}function S(e,t,r){var i=$(e.begin,e.end),o=$(e.begin,fn.begin),a=z(e),c=A(e),s=Q(e),u=n("<div>",{class:"sg_activity",css:{width:i,left:o,backgroundColor:a,height:c}});t.append(u),s&&(u.click(function(){s(e,r,pn)}),u.css("cursor","pointer")),T(e,u,r.description)}function T(n,e,t){var r=z(n),i=n.description,o=t;P(e,r,i,N(n),i[0],o)}function N(n){return on(n.begin,!0)+" â€” "+on(n.end,!an(n.begin,n.end))}function R(){vn.length&&vn.forEach(F)}function F(e){var t=X(e),r=parseInt(q())*pn.length+"px",i=B(e),o=$(e.when,fn.begin),a=K(e),c={width:t,height:r,left:o,backgroundColor:i},s=n("<div>",{class:"sg_general_marker "+(Dn?"with_datetime_header":"with_time_header"),css:c});un.append(s),a&&(s.click(function(){a(e,pn)}),s.css("cursor","pointer")),O(e,s)}function $(n,e){return Math.abs(n-e)/36e5*mn+"px"}function q(){return bn&&bn.rowHeight?bn.rowHeight:u}function z(n){if(n.color)return n.color;var e=kn[n.code];return e&&e.color?e.color:c}function A(n){if(n.height)return n.height;var e=kn[n.code];return e&&e.height?e.height:s}function Q(n){return void 0!==n.onClick?n.onClick:Wn}function X(n){return n.width?n.width:d}function Y(n){return n.height?n.height:l}function B(n){return n.color?n.color:h}function J(n){return void 0!==n.onClick?n.onClick:jn}function K(n){return void 0!==n.onClick?n.onClick:Gn}function P(t,r,i,o,a,c,s){var u=function(l){t.addClass("hover");var d=n("<div>",{class:"sg_tooltip"}),h=e(r);V(d,i,o,a,c,r,h,s);var f=U(l,d);f.position="absolute",f.borderColor=r,d.css(f),d.mouseover(nn(d)),d.mouseout(Z(t,d,u)),t.unbind("mouseover mouseout"),t.mouseover(nn(d)),t.mouseout(Z(t,d,u)),n("body").append(d)};t.mouseover(u)}function U(e,t){var r=n(window),i=e.pageX+5,o=e.pageY+5,a=i+cn(t).width,c=r.scrollLeft()+r.width();a>=c-50&&(i-=a-c+50);var s=o+cn(t).height,u=r.scrollTop()+r.height();return s>=u-75&&(o-=s-u+75),{left:i,top:o}}function V(e,t,r,i,o,a,c,s){if(i){var u=n("<div>",{class:"sg_tooltip_badge",html:i,css:{backgroundColor:a,color:c}});s&&u.addClass("square"),e.append(u)}var l=n("<span>",{class:"sg_tooltip_title",html:t});if(e.append(l),o){var d=n("<span>",{class:"sg_tooltip_subtitle",html:o});e.append(d)}if(r){var h=n("<div>",{class:"sg_tooltip_description_wrapper"}),f=n("<div>",{class:"sg_tooltip_description",html:r});h.append(f),e.append(h)}}function Z(n,e,t){return function(){e.shallRemove=!0,setTimeout(function(){e.shallRemove&&(e.remove(),n.unbind("mouseover mouseout"),n.removeClass("hover"),n.mouseover(t))},50)}}function nn(n){return function(){n.shallRemove=!1}}function en(){tn(),Cn||(Cn=!0,n(window).on("resize",tn))}function tn(){rn("inline-block","inline-block"),sn.outerWidth()>=t.width()&&rn("block","grid")}function rn(n,e){sn.css("display",""),un.css("display",""),sn.css("display",n),un.css("display",e)}function on(n,e){var t="";return e&&(t=In(n)+" "),t+=On(n)}function an(n,e){return n=new Date(n).setHours(0,0,0,0),e=new Date(e).setHours(0,0,0,0),n===e}function cn(e){var t=e.clone().show().css("visibility","hidden");n("body").append(t);var r={width:t.width(),height:t.height()};return t.remove(),r}var sn,un,ln,dn,hn,fn,pn,vn,gn,mn,wn,_n,bn,kn,yn,Cn,Dn,Hn,Mn,En,xn,Wn,jn,Gn;this.update=function(n,e){pn=n,vn=e||[],this.clearGraphicElements(),this.build()},this.clearOptions=function(){fn=null,pn=null,vn=null,gn=null,mn=null,wn=null,_n=null,bn=null,kn=null,yn=null,Wn=null,jn=null,Gn=null,Dn=null,Hn=null,En=null,xn=null},this.clearGraphicElements=function(){t.empty()},this.config=function(n){pn=i(n.data),vn=v(n.generalMarkers?n.generalMarkers:[]),(bn=n.style)?(gn=bn.descriptionContainerWidth?bn.descriptionContainerWidth:o,kn=bn.activityStyle?bn.activityStyle:{},mn=bn.hourWidth?bn.hourWidth:a,yn=bn.months?bn.months:f,Dn=bn.showDateOnHeader,Mn=bn.noDataText?bn.noDataText:p,bn.formatHour&&(On=bn.formatHour),bn.formatDate&&(In=bn.formatDate),Hn=bn.dateHeaderFormat?bn.dateHeaderFormat:In):(kn={},mn=a,yn=f,Hn=In,Mn=p);var e=n.events;e&&(Wn=e.onActivityClick,jn=e.onMarkerClick,Gn=e.onGeneralMarkerClick)},this.build=function(){pn&&pn.length?(w(),k(),D(),x(),R(),en()):m()};var In=function(n){var e=n.getDate();return(e=("0"+e).slice(-2))+"/"+yn[n.getMonth()]},On=function(n){var e=n.getHours();e=("0"+e).slice(-2);var t=n.getMinutes();return t=("0"+t).slice(-2),e+":"+t}}var o="250px",a=80,c="#7fad7f",s="20px",u="50px",l="30px",d="3px",h="#e0a00e",f=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],p="No data to display.";n.fn.stackedGantt=function(e){var t=n(this),r=new i(t);return t.stackedGantt=r,r.clearOptions(),r.clearGraphicElements(),r.config(e),r.build(),t.update=function(n,e){r.update(n,e)},t}}(jQuery);