/*! Stacked Gantt - v0.1.0 - 2017-07-31
* https://github.com/demarchisd/stacked-gantt
* Copyright (c) 2017 Bruno Kewitz Demarchi; Licensed MIT */

!function(n){"use strict";function t(n){return"#"===n[0]&&(n=e(n)),.2126*n.r+.7152*n.g+.0722*n.b<170?"#fff":"#585050"}function e(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,e,r){return t+t+e+e+r+r});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function r(n,t){return"rgba("+n.r+","+n.g+","+n.b+","+t+")"}function i(n){var t=function(t){(t=window.event||t).wheelDelta||t.detail||(t=t.originalEvent);var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));n.scrollLeft(n.scrollLeft()-40*e),t.preventDefault()};n.bind("mousewheel DOMMouseScroll",t)}function o(o){function w(n){return n.forEach(function(n){n.thresholds&&n.thresholds.forEach(function(n){n.begin=k(n.begin),n.end=k(n.end)}),n.markers&&n.markers.forEach(function(n){n.when=k(n.when)}),n.activities.forEach(function(n){n.begin=k(n.begin),n.end=k(n.end)})}),n}function b(n){if(n)return n.forEach(function(n){n.when=k(n.when)}),n}function k(n){if("[object Date]"===Object.prototype.toString.call(n))return n;if(!isNaN(n))return new Date(n);throw new Error("Invalid Date: "+n)}function y(){var t=n("<div>",{class:"sg_no_data",html:Wn});o.append(t)}function C(){var t=n("<div>",{class:"sg_container_wrapper"});o.append(t),vn=n("<div>",{class:"sg_container"}),t.append(vn),mn=n("<div>",{class:"sg_desc_container "+(zn?"with_datetime_header":"with_time_header"),css:{width:Cn}}),vn.append(mn),gn=n("<div>",{class:"sg_val_container"}),vn.append(gn),i(gn),zn&&H()}function H(){gn.scroll(function(){jn&&(jn.remove(),jn=null);var n=gn.scrollLeft(),t=E(n),e=Math.floor(n/Hn),r=Dn[e];jn=I(r,null,n,t)})}function E(n){return Ln.reduce(function(t,e){if(t)return t;var r=parseInt(e.css("left")),i=Math.ceil(r+e.outerWidth());return n>=r&&n<=i},!1)}function D(){var n=kn.map(function(n){return{begin:M(n),end:x(n)}}),t=new Date(n.map(function(n){return n.begin}).concat(yn.map(function(n){return n.when})).reduce(function(n,t){return t<n?t:n}));t.getMinutes()<=10&&t.setHours(t.getHours()-1),t.setMinutes(0);var e=new Date(n.map(function(n){return n.end}).concat(yn.map(function(n){return n.when})).reduce(function(n,t){return t>n?t:n}));e.getMinutes()>=50&&e.setHours(e.getHours()+1),e.setMinutes(0),bn={begin:t,end:e}}function M(n){var t=n.activities.map(function(n){return n.begin});return n.markers&&(t=t.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(t=t.concat(n.thresholds.map(function(n){return n.begin}))),t.reduce(function(n,t){return t<n?t:n})}function x(n){var t=n.activities.map(function(n){return n.end});return n.markers&&(t=t.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(t=t.concat(n.thresholds.map(function(n){return n.end}))),t.reduce(function(n,t){return t>n?t:n})}function G(){zn&&(Ln=[],_n=n("<div>",{class:"sg_date_header_container"}),gn.append(_n)),wn=n("<div>",{class:"sg_time_header_container"}),gn.append(wn),Dn=O(),En=Dn.length,Dn.forEach(function(n,t){z(n),zn&&(0!==t&&0!==n.getHours()||Ln.push(I(n,t)))})}function I(t,e,r,i){var o={minWidth:Hn+"px",left:(e?Hn*e:r)+"px"},a=n("<div>",{class:"sg_date_header_item "+(r?"scroll ":"")+(i?"conflict ":""),css:o});return _n.append(a),a.html(On(t)),a}function z(t){var e=n("<div>",{class:"sg_time_header_item",css:{width:Hn+"px"}});wn.append(e),e.html(An(t)),zn&&e.attr("title",On(t))}function O(){for(var n=[],t=new Date(bn.begin);t<=bn.end;t.setHours(t.getHours()+1))n.push(new Date(t));return n}function W(){kn.forEach(function(n,t){var e=t%2==0;j(n,e),L(n,e)})}function j(t,e){var r=Y(),i={height:r,lineHeight:r},o=n("<div>",{class:"sg_row_desc_container "+(e?"even":"odd"),css:i});mn.append(o),o.html(t.description)}function L(t,e){var r=Y(),i={height:r,lineHeight:r,width:En*Hn},o=n("<div>",{class:"sg_row_val_container "+(e?"even":"odd"),css:i});gn.append(o),t.activities.forEach(function(n){A(n,o,t)}),t.thresholds&&t.thresholds.forEach(function(n){S(n,o)}),t.markers&&t.markers.forEach(function(n){T(n,o,t)})}function S(t,i){if(t&&t.begin&&t.end){var o=_,a=r(e(P(t)),o),c=U(t),s=X(t.begin,t.end),u=X(t.begin,bn.begin),l={backgroundColor:a},d=n("<div>",{class:"sg_threshold",css:{width:s,left:u,height:c}});i.append(d);var h=n("<div>",{class:"sg_threshold_limit begin",css:l});d.append(h);var f=n("<div>",{class:"sg_threshold_line",css:l});d.append(f);var p=n("<div>",{class:"sg_threshold_limit end",css:l});d.append(p)}}function T(t,e,r){var i=V(t),o=Z(t),a=nn(t),c=X(t.when,bn.begin),s=tn(t),u=n("<div>",{class:"sg_marker",css:{width:i,height:o,left:c,backgroundColor:a}});e.append(u),s&&(u.click(function(){s(t,r,kn)}),u.css("cursor","pointer")),N(t,u,r.description)}function N(n,t,e){var r=nn(n),i=n.description,o=e;rn(t,r,i,R(n),i[0],o,!0)}function R(n){return hn(n.when,!0)}function A(t,e,r){var i=X(t.begin,t.end),o=X(t.begin,bn.begin),a=B(t),c=J(t),s=K(t),u=n("<div>",{class:"sg_activity",css:{width:i,left:o,backgroundColor:a,height:c}});e.append(u),s&&(u.click(function(){s(t,r,kn)}),u.css("cursor","pointer")),F(t,u,r.description)}function F(n,t,e){var r=B(n),i=n.description,o=e;rn(t,r,i,$(n),i[0],o)}function $(n){return hn(n.begin,!0)+" â€” "+hn(n.end,!fn(n.begin,n.end))}function q(){yn.length&&yn.forEach(Q)}function Q(t){var e=V(t),r=parseInt(Y())*kn.length+"px",i=nn(t),o=X(t.when,bn.begin),a=en(t),c={width:e,height:r,left:o,backgroundColor:i},s=n("<div>",{class:"sg_general_marker "+(zn?"with_datetime_header":"with_time_header"),css:c});gn.append(s),a&&(s.click(function(){a(t,kn)}),s.css("cursor","pointer")),N(t,s)}function X(n,t){return Math.abs(n-t)/36e5*Hn+"px"}function Y(){return Mn&&Mn.rowHeight?Mn.rowHeight:l}function B(n){if(n.color)return n.color;var t=xn[n.code];return t&&t.color?t.color:s}function J(n){if(n.height)return n.height;var t=xn[n.code];return t&&t.height?t.height:u}function K(n){return void 0!==n.onClick?n.onClick:Sn}function P(n){return n.color?n.color:Mn&&Mn.thresholdColor?Mn.thresholdColor:m}function U(n){return n.height?n.height:Mn&&Mn.thresholdHeight?Mn.thresholdHeight:g}function V(n){return n.width?n.width:h}function Z(n){return n.height?n.height:d}function nn(n){return n.color?n.color:f}function tn(n){return void 0!==n.onClick?n.onClick:Tn}function en(n){return void 0!==n.onClick?n.onClick:Nn}function rn(e,r,i,o,a,c,s){var u=function(l){e.addClass("hover");var d=n("<div>",{class:"sg_tooltip"}),h=t(r);an(d,i,o,a,c,r,h,s);var f=on(l,d);f.position="absolute",f.borderColor=r,d.css(f),d.mouseover(sn(d)),d.mouseout(cn(e,d,u)),e.unbind("mouseover mouseout"),e.mouseover(sn(d)),e.mouseout(cn(e,d,u)),n("body").append(d)};e.mouseover(u)}function on(t,e){var r=n(window),i=t.pageX+5,o=t.pageY+5,a=i+pn(e).width,c=r.scrollLeft()+r.width();a>=c-50&&(i-=a-c+50);var s=o+pn(e).height,u=r.scrollTop()+r.height();return s>=u-75&&(o-=s-u+75),{left:i,top:o}}function an(t,e,r,i,o,a,c,s){if(i){var u=n("<div>",{class:"sg_tooltip_badge",html:i,css:{backgroundColor:a,color:c}});s&&u.addClass("square"),t.append(u)}var l=n("<span>",{class:"sg_tooltip_title",html:e});if(t.append(l),o){var d=n("<span>",{class:"sg_tooltip_subtitle",html:o});t.append(d)}r&&(r.constructor!==Array&&(r=[r]),r.forEach(function(e){var r,i;"string"==typeof e?i=e:(r=e.title,i=e.description);var o=n("<div>",{class:"sg_tooltip_description_wrapper"}),a=n("<div>",{class:"sg_tooltip_description"});if(o.append(a),r){var c=n("<span>",{class:"sg_tooltip_description_title",html:r});a.append(c)}a.append(i),t.append(o)}))}function cn(n,t,e){return function(){t.shallRemove=!0,setTimeout(function(){t.shallRemove&&(t.remove(),n.unbind("mouseover mouseout"),n.removeClass("hover"),n.mouseover(e))},50)}}function sn(n){return function(){n.shallRemove=!1}}function un(){ln(),In||(In=!0,n(window).on("resize",ln))}function ln(){dn("inline-block","inline-block"),vn.outerWidth()>=o.width()&&dn("block","grid")}function dn(n,t){vn.css("display",""),gn.css("display",""),vn.css("display",n),gn.css("display",t)}function hn(n,t){var e="";return t&&(e=Rn(n)+" "),e+=An(n)}function fn(n,t){return n=new Date(n).setHours(0,0,0,0),t=new Date(t).setHours(0,0,0,0),n===t}function pn(t){var e=t.clone().show().css("visibility","hidden");n("body").append(e);var r={width:e.width(),height:e.height()};return e.remove(),r}var vn,gn,mn,_n,wn,bn,kn,yn,Cn,Hn,En,Dn,Mn,xn,Gn,In,zn,On,Wn,jn,Ln,Sn,Tn,Nn;this.update=function(n,t){kn=n,yn=t||[],this.clearGraphicElements(),this.build()},this.clearOptions=function(){bn=null,kn=null,yn=null,Cn=null,Hn=null,En=null,Dn=null,Mn=null,xn=null,Gn=null,Sn=null,Tn=null,Nn=null,zn=null,On=null,jn=null,Ln=null},this.clearGraphicElements=function(){o.empty()},this.config=function(n){kn=w(n.data),yn=b(n.generalMarkers?n.generalMarkers:[]),(Mn=n.style)?(Cn=Mn.descriptionContainerWidth?Mn.descriptionContainerWidth:a,xn=Mn.activityStyle?Mn.activityStyle:{},Hn=Mn.hourWidth?Mn.hourWidth:c,Gn=Mn.months?Mn.months:p,zn=Mn.showDateOnHeader,Wn=Mn.noDataText?Mn.noDataText:v,Mn.formatHour&&(An=Mn.formatHour),Mn.formatDate&&(Rn=Mn.formatDate),On=Mn.dateHeaderFormat?Mn.dateHeaderFormat:Rn):(xn={},Hn=c,Gn=p,On=Rn,Wn=v);var t=n.events;t&&(Sn=t.onActivityClick,Tn=t.onMarkerClick,Nn=t.onGeneralMarkerClick)},this.zoomIn=function(){Hn*=1.1,this.clearGraphicElements(),this.build()},this.zoomOut=function(){Hn*=.9,this.clearGraphicElements(),this.build()},this.destroy=function(){this.clearGraphicElements(),delete o.update,delete o.zoomIn,delete o.zoomOut,delete o.destroy,delete o.stackedGantt},this.build=function(){kn&&kn.length?(C(),D(),G(),W(),q(),un()):y()};var Rn=function(n){var t=n.getDate();return(t=("0"+t).slice(-2))+"/"+Gn[n.getMonth()]},An=function(n){var t=n.getHours();t=("0"+t).slice(-2);var e=n.getMinutes();return e=("0"+e).slice(-2),t+":"+e}}var a="250px",c=80,s="#7fad7f",u="20px",l="50px",d="30px",h="3px",f="#e0a00e",p=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],v="No data to display.",g="20px",m="#000000",_=.3;n.fn.stackedGantt=function(t){var e=n(this),r=new o(e);return e.stackedGantt=r,r.clearOptions(),r.clearGraphicElements(),r.config(t),r.build(),e.update=function(n,t){r.update(n,t)},e.zoomIn=function(){r.zoomIn()},e.zoomOut=function(){r.zoomOut()},e.destroy=function(){r.destroy()},e}}(jQuery);