/*! Stacked Gantt - v0.1.1 - 2017-10-24
* https://github.com/demarchisd/stacked-gantt
* Copyright (c) 2017 Bruno Kewitz Demarchi; Licensed MIT */

!function(n){"use strict";function e(n){return"#"===n[0]&&(n=t(n)),.2126*n.r+.7152*n.g+.0722*n.b<170?"#fff":"#585050"}function t(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,e,t,i){return e+e+t+t+i+i});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function i(n,e){return"rgba("+n.r+","+n.g+","+n.b+","+e+")"}function r(n){var e=function(e){(e=window.event||e).wheelDelta||e.detail||(e=e.originalEvent);var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));n.scrollLeft(n.scrollLeft()-40*t),e.preventDefault()};n.bind("mousewheel DOMMouseScroll",e)}function o(o){function w(n){return n.forEach(function(n){n.thresholds&&n.thresholds.forEach(function(n){n.begin=k(n.begin),n.end=k(n.end)}),n.markers&&n.markers.forEach(function(n){n.when=k(n.when)}),n.activities.forEach(function(n){n.begin=k(n.begin),n.end=k(n.end)})}),n}function b(n){if(n)return n.forEach(function(n){n.when=k(n.when)}),n}function k(n){if("[object Date]"===Object.prototype.toString.call(n))return n;if(!isNaN(n))return new Date(n);throw new Error("Invalid Date: "+n)}function D(){var e=n("<div>",{class:"sg_no_data",html:Wn});o.append(e)}function y(){var e=n("<div>",{class:"sg_container_wrapper"});o.append(e),gn=n("<div>",{class:"sg_container"}),e.append(gn),mn=n("<div>",{class:"sg_desc_container "+(zn?"with_datetime_header":"with_time_header"),css:{width:yn}}),gn.append(mn),vn=n("<div>",{class:"sg_val_container"}),gn.append(vn),r(vn),zn&&H()}function H(){vn.scroll(function(){jn&&(jn.remove(),jn=null);var n=vn.scrollLeft(),e=C(n),t=Math.floor(n/Hn),i=En[t];jn=I(i,null,n,e)})}function C(n){return Ln.reduce(function(e,t){if(e)return e;var i=parseInt(t.css("left")),r=Math.ceil(i+t.outerWidth());return n>=i&&n<=r},!1)}function E(){var n=kn.map(function(n){return{begin:M(n),end:x(n)}}),e=new Date(n.map(function(n){return n.begin}).concat(Dn.map(function(n){return n.when})).reduce(function(n,e){return e<n?e:n}));e.getMinutes()<=10&&e.setHours(e.getHours()-1),e.setMinutes(0);var t=new Date(n.map(function(n){return n.end}).concat(Dn.map(function(n){return n.when})).reduce(function(n,e){return e>n?e:n}));t.getMinutes()>=50&&t.setHours(t.getHours()+1),t.setMinutes(0),bn={begin:e,end:t}}function M(n){var e=[];return n.activities&&(e=e.concat(n.activities.map(function(n){return n.begin}))),n.markers&&(e=e.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(e=e.concat(n.thresholds.map(function(n){return n.begin}))),e.length?e.reduce(function(n,e){return e<n?e:n}):Sn}function x(n){var e=[];return n.activities&&(e=e.concat(n.activities.map(function(n){return n.end}))),n.markers&&(e=e.concat(n.markers.map(function(n){return n.when}))),n.thresholds&&(e=e.concat(n.thresholds.map(function(n){return n.end}))),e.length?e.reduce(function(n,e){return e>n?e:n}):Tn}function G(){zn&&(Ln=[],_n=n("<div>",{class:"sg_date_header_container"}),vn.append(_n)),wn=n("<div>",{class:"sg_time_header_container"}),vn.append(wn),En=O(),Cn=En.length,En.forEach(function(n,e){z(n),zn&&(0!==e&&0!==n.getHours()||Ln.push(I(n,e)))})}function I(e,t,i,r){var o={minWidth:Hn+"px",left:(t?Hn*t:i)+"px"},a=n("<div>",{class:"sg_date_header_item "+(i?"scroll ":"")+(r?"conflict ":""),css:o});return _n.append(a),a.html(On(e)),a}function z(e){var t=n("<div>",{class:"sg_time_header_item",css:{width:Hn+"px"}});wn.append(t),t.html(Fn(e)),zn&&t.attr("title",On(e))}function O(){for(var n=[],e=new Date(bn.begin);e<=bn.end;e.setHours(e.getHours()+1))n.push(new Date(e));return n}function W(){kn.forEach(function(n,e){var t=e%2==0;j(n,t),L(n,t)})}function j(e,t){var i=X(),r={height:i,lineHeight:i},o=n("<div>",{class:"sg_row_desc_container "+(t?"even":"odd"),css:r});mn.append(o),o.html(e.description)}function L(e,t){var i=X(),r={height:i,lineHeight:i,width:Cn*Hn},o=n("<div>",{class:"sg_row_val_container "+(t?"even":"odd"),css:r});vn.append(o),e.activities.forEach(function(n){A(n,o,e)}),e.thresholds&&e.thresholds.forEach(function(n){S(n,o)}),e.markers&&e.markers.forEach(function(n){T(n,o,e)})}function S(e,r){if(e&&e.begin&&e.end){var o=_,a=i(t(P(e)),o),s=U(e),c=Q(e.begin,e.end),u=Q(e.begin,bn.begin),l={backgroundColor:a},d=n("<div>",{class:"sg_threshold",css:{width:c,left:u,height:s}});r.append(d);var h=n("<div>",{class:"sg_threshold_limit begin",css:l});d.append(h);var f=n("<div>",{class:"sg_threshold_line",css:l});d.append(f);var p=n("<div>",{class:"sg_threshold_limit end",css:l});d.append(p)}}function T(e,t,i){var r=V(e),o=Z(e),a=nn(e),s=Q(e.when,bn.begin),c=en(e),u=n("<div>",{class:"sg_marker",css:{width:r,height:o,left:s,backgroundColor:a}});t.append(u),c&&(u.click(function(){c(e,i,kn)}),u.css("cursor","pointer")),N(e,u,i.description)}function N(n,e,t){var i=nn(n),r=n.description,o=t;rn(e,i,r,R(n),r[0],o,!0)}function R(n){return hn(n.when,!0)}function A(e,t,i){var r=Q(e.begin,e.end),o=Q(e.begin,bn.begin),a=Y(e),s=J(e),c=K(e),u=n("<div>",{class:"sg_activity",css:{width:r,left:o,backgroundColor:a,height:s}});t.append(u),c&&(u.click(function(){c(e,i,kn)}),u.css("cursor","pointer")),B(e,u,i.description)}function B(n,e,t){var i=Y(n),r=n.description,o=t;rn(e,i,r,F(n),r[0],o)}function F(n){return hn(n.begin,!0)+" â€” "+hn(n.end,!fn(n.begin,n.end))}function $(){Dn.length&&Dn.forEach(q)}function q(e){var t=V(e),i=parseInt(X())*kn.length+"px",r=nn(e),o=Q(e.when,bn.begin),a=tn(e),s={width:t,height:i,left:o,backgroundColor:r},c=n("<div>",{class:"sg_general_marker "+(zn?"with_datetime_header":"with_time_header"),css:s});vn.append(c),a&&(c.click(function(){a(e,kn)}),c.css("cursor","pointer")),N(e,c)}function Q(n,e){return Math.abs(n-e)/36e5*Hn+"px"}function X(){return Mn&&Mn.rowHeight?Mn.rowHeight:l}function Y(n){if(n.color)return n.color;var e=xn[n.code];return e&&e.color?e.color:c}function J(n){if(n.height)return n.height;var e=xn[n.code];return e&&e.height?e.height:u}function K(n){return void 0!==n.onClick?n.onClick:Nn}function P(n){return n.color?n.color:Mn&&Mn.thresholdColor?Mn.thresholdColor:m}function U(n){return n.height?n.height:Mn&&Mn.thresholdHeight?Mn.thresholdHeight:v}function V(n){return n.width?n.width:h}function Z(n){return n.height?n.height:d}function nn(n){return n.color?n.color:f}function en(n){return void 0!==n.onClick?n.onClick:Rn}function tn(n){return void 0!==n.onClick?n.onClick:An}function rn(t,i,r,o,a,s,c){var u=function(l){t.addClass("hover");var d=n("<div>",{class:"sg_tooltip"}),h=e(i);an(d,r,o,a,s,i,h,c);var f=on(l,d);f.position="absolute",f.borderColor=i,d.css(f),d.mouseover(cn(d)),d.mouseout(sn(t,d,u)),t.unbind("mouseover mouseout"),t.mouseover(cn(d)),t.mouseout(sn(t,d,u)),n("body").append(d)};t.mouseover(u)}function on(e,t){var i=n(window),r=e.pageX+5,o=e.pageY+5,a=r+pn(t).width,s=i.scrollLeft()+i.width();a>=s-50&&(r-=a-s+50);var c=o+pn(t).height,u=i.scrollTop()+i.height();return c>=u-75&&(o-=c-u+75),{left:r,top:o}}function an(e,t,i,r,o,a,s,c){if(r){var u=n("<div>",{class:"sg_tooltip_badge",html:r,css:{backgroundColor:a,color:s}});c&&u.addClass("square"),e.append(u)}var l=n("<span>",{class:"sg_tooltip_title",html:t});if(e.append(l),o){var d=n("<span>",{class:"sg_tooltip_subtitle",html:o});e.append(d)}i&&(i.constructor!==Array&&(i=[i]),i.forEach(function(t){var i,r;"string"==typeof t?r=t:(i=t.title,r=t.description);var o=n("<div>",{class:"sg_tooltip_description_wrapper"}),a=n("<div>",{class:"sg_tooltip_description"});if(o.append(a),i){var s=n("<span>",{class:"sg_tooltip_description_title",html:i});a.append(s)}a.append(r),e.append(o)}))}function sn(n,e,t){return function(){e.shallRemove=!0,setTimeout(function(){e.shallRemove&&(e.remove(),n.unbind("mouseover mouseout"),n.removeClass("hover"),n.mouseover(t))},50)}}function cn(n){return function(){n.shallRemove=!1}}function un(){ln(),In||(In=!0,n(window).on("resize",ln))}function ln(){dn("inline-block","inline-block"),gn.outerWidth()>=o.width()&&dn("block","grid")}function dn(n,e){gn.css("display",""),vn.css("display",""),gn.css("display",n),vn.css("display",e)}function hn(n,e){var t="";return e&&(t=Bn(n)+" "),t+=Fn(n)}function fn(n,e){return n=new Date(n).setHours(0,0,0,0),e=new Date(e).setHours(0,0,0,0),n===e}function pn(e){var t=e.clone().show().css("visibility","hidden");n("body").append(t);var i={width:t.width(),height:t.height()};return t.remove(),i}var gn,vn,mn,_n,wn,bn,kn,Dn,yn,Hn,Cn,En,Mn,xn,Gn,In,zn,On,Wn,jn,Ln,Sn,Tn,Nn,Rn,An;this.update=function(n,e){kn=n,Dn=e||[],this.clearGraphicElements(),this.build()},this.clearOptions=function(){bn=null,kn=null,Dn=null,yn=null,Hn=null,Cn=null,En=null,Mn=null,xn=null,Gn=null,Nn=null,Rn=null,An=null,zn=null,On=null,jn=null,Ln=null,Sn=null,Tn=null},this.clearGraphicElements=function(){o.empty()},this.config=function(n){kn=w(n.data),Dn=b(n.generalMarkers?n.generalMarkers:[]),(Mn=n.style)?(yn=Mn.descriptionContainerWidth?Mn.descriptionContainerWidth:a,xn=Mn.activityStyle?Mn.activityStyle:{},Hn=Mn.hourWidth?Mn.hourWidth:s,Gn=Mn.months?Mn.months:p,zn=Mn.showDateOnHeader,Wn=Mn.noDataText?Mn.noDataText:g,Sn=Mn.defaultBeginDate?Mn.defaultBeginDate:new Date((new Date).setHours(1)).setMinutes(0),Tn=Mn.defaultEndDate?Mn.defaultEndDate:new Date((new Date).setHours(23)).setMinutes(0),Mn.formatHour&&(Fn=Mn.formatHour),Mn.formatDate&&(Bn=Mn.formatDate),On=Mn.dateHeaderFormat?Mn.dateHeaderFormat:Bn):(xn={},Hn=s,Gn=p,On=Bn,Wn=g);var e=n.events;e&&(Nn=e.onActivityClick,Rn=e.onMarkerClick,An=e.onGeneralMarkerClick)},this.zoomIn=function(){Hn*=1.1,this.clearGraphicElements(),this.build()},this.zoomOut=function(){Hn*=.9,this.clearGraphicElements(),this.build()},this.destroy=function(){this.clearGraphicElements(),delete o.update,delete o.zoomIn,delete o.zoomOut,delete o.destroy,delete o.stackedGantt},this.build=function(){kn&&kn.length?(y(),E(),G(),W(),$(),un()):D()};var Bn=function(n){var e=n.getDate();return(e=("0"+e).slice(-2))+"/"+Gn[n.getMonth()]},Fn=function(n){var e=n.getHours();e=("0"+e).slice(-2);var t=n.getMinutes();return t=("0"+t).slice(-2),e+":"+t}}var a="250px",s=80,c="#7fad7f",u="20px",l="50px",d="30px",h="3px",f="#e0a00e",p=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],g="No data to display.",v="20px",m="#000000",_=.3;n.fn.stackedGantt=function(e){var t=n(this),i=new o(t);return t.stackedGantt=i,i.clearOptions(),i.clearGraphicElements(),i.config(e),i.build(),t.update=function(n,e){i.update(n,e)},t.zoomIn=function(){i.zoomIn()},t.zoomOut=function(){i.zoomOut()},t.destroy=function(){i.destroy()},t}}(jQuery);