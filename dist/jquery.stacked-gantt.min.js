/*! Stacked Gantt - v0.2.3 - 2019-08-06
* https://github.com/demarchisd/stacked-gantt
* Copyright (c) 2019 Bruno Kewitz Demarchi; Licensed MIT */

!function(ie){"use strict";var oe=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],ae="No data to display.";function se(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function n(r){var i,u,o,l,a,s,G,O,c,d,h,f,p,g,v,I,m,b,w,_,k,D,H,M,E,C,y,x,T,z,j,W,L;function S(e){if("[object Date]"===Object.prototype.toString.call(e))return e;if(!isNaN(e))return new Date(e);throw new Error("Invalid Date: "+e)}function A(i){return M.reduce(function(e,t){if(e)return e;var n=parseInt(t.css("left")),r=Math.ceil(n+t.outerWidth());return n<=i&&i<=r},!1)}function N(e,t,n,r){var i=ie("<div>",{class:"sg_date_header_item "+(n?"scroll ":"")+(r?"conflict ":""),css:{minWidth:f+"px",left:(t?f*t:n)+"px"}});return a.append(i),i.html(k(e)),i}function R(e,t,n){var r=Y(e),i=e.description,o=n,a=Z(e.when,!0),s=i?i[0]:"?";J(t,q(),r,i,a,"",s,o,!0)}function $(e){var t,n=X(e),r=parseInt(Q())*O.length+"px",i=Y(e),o=F(e.when,G.begin),a=void 0!==(t=e).onClick?t.onClick:L,s=ie("<div>",{class:"sg_general_marker",css:{width:n,height:r,left:o,backgroundColor:i}});u.append(s),a&&(s.click(function(){a(e,O)}),s.css("cursor","pointer")),R(e,s)}function B(e){var t,n=F(e.begin,e.end),r=parseInt(Q())*O.length+"px",i=(t=e).color?t.color:"#e0a00e",o=F(e.begin,G.begin),a=ie("<div>",{class:"sg_general_highlight",css:{width:n,height:r,left:o,backgroundColor:i}});u.append(a)}function F(e,t){var n=60*Math.abs(e.getTimezoneOffset()-t.getTimezoneOffset())*1e3;return(Math.abs(e-t)-n)/36e5*f+"px"}function q(){return v&&v.tooltipTemplate?v.tooltipTemplate:null}function Q(){return v&&v.rowHeight?v.rowHeight:"50px"}function U(e){if(e.color)return e.color;var t=I[e.code];return t&&t.color?t.color:"#7fad7f"}function X(e){return e.width?e.width:"3px"}function Y(e){return e.color?e.color:"#e0a00e"}function J(c,u,l,d,h,f,p,g,v){var m=function(e){c.addClass("hover");var t,n=null;if(u){var r=u.split(/\$\{(.+?)\}/g),i={badge:p,title:d,subtitle:g,description:h,duration:f},o=r.map(function(e,t){return t%2?i[e]:e}).join("");n=ie(o)}else{n=ie("<div>",{class:"sg_tooltip"});var a=("#"===(t=l)[0]&&(t=se(t)),.2126*t.r+.7152*t.g+.0722*t.b<170?"#fff":"#585050");!function(a,e,t,n,r,i,o,s){if(n){var c=ie("<div>",{class:"sg_tooltip_badge",html:n,css:{backgroundColor:i,color:o}});s&&c.addClass("square"),a.append(c)}var u=ie("<span>",{class:"sg_tooltip_title",html:e});if(a.append(u),r){var l=ie("<span>",{class:"sg_tooltip_subtitle",html:r});a.append(l)}t&&(t.constructor!==Array&&(t=[t]),t.forEach(function(e){var t,n;n="string"==typeof e?e:(t=e.title,e.description);var r=ie("<div>",{class:"sg_tooltip_description_wrapper"}),i=ie("<div>",{class:"sg_tooltip_description"});if(r.append(i),t){var o=ie("<span>",{class:"sg_tooltip_description_title",html:t});i.append(o)}i.append(n),a.append(r)}))}(n,d,h,p,g,l,a,v)}var s=function(e,t){var n=ie(window),r=e.pageX+5,i=e.pageY+5,o=ne(t).width,a=r+o,s=n.scrollLeft()+n.width();s-50<=a&&(r-=a-s+50);var c=ne(t).height,u=i+c,l=n.scrollTop()+n.height();l-75<=u&&(i-=u-l+75);return{left:r,top:i}}(e,n);s.position="absolute",s.borderColor=l,n.css(s),n.mouseover(P(n)),n.mouseout(K(c,n,m)),c.unbind("mouseover mouseout"),c.mouseover(P(n)),c.mouseout(K(c,n,m)),re().append(n)};c.mouseover(m)}function K(e,t,n){return function(){t.shallRemove=!0,setTimeout(function(){t.shallRemove&&(t.remove(),e.unbind("mouseover mouseout"),e.removeClass("hover"),e.mouseover(n))},50)}}function P(e){return function(){e.shallRemove=!1}}function V(){}function Z(e,t){var n="";return t&&(n=ee(e)+" "),n+=te(e)}this.update=function(e,t,n){O=e,c=t||[],d=n||[],this.clearGraphicElements(),this.build()},this.clearOptions=function(){_=!(w=L=W=j=m=I=v=g=p=f=h=d=c=O=G=null),z=T=x=y=C=E=M=H=k=null},this.clearGraphicElements=function(){r.empty()},this.config=function(e){var t;(t=e.data).forEach(function(e){e.thresholds&&e.thresholds.forEach(function(e){e.begin=S(e.begin),e.end=S(e.end)}),e.markers&&e.markers.forEach(function(e){e.when=S(e.when)}),e.activities.forEach(function(e){e.begin=S(e.begin),e.end=S(e.end)})}),O=t,c=function(e){if(!e)return;return e.forEach(function(e){e.when=S(e.when)}),e}(e.generalMarkers?e.generalMarkers:[]),d=function(e){if(!e)return;return e.forEach(function(e){e.begin=S(e.begin),e.end=S(e.end)}),e}(e.generalHighlights?e.generalHighlights:[]),(v=e.style)?(h=v.descriptionContainerWidth?v.descriptionContainerWidth:"250px",I=v.activityStyle?v.activityStyle:{},f=v.hourWidth?v.hourWidth:80,m=v.months?v.months:oe,w=v.showDateOnHeader,D=v.noDataText?v.noDataText:ae,E=v.defaultBeginDate?v.defaultBeginDate:new Date((new Date).setHours(1)).setMinutes(0),C=v.defaultEndDate?v.defaultEndDate:new Date((new Date).setHours(23)).setMinutes(0),y=v.beginDate,x=v.endDate,T=!1!==v.autoAdjustLimits,void 0!==v.showTimeOnHeader&&(_=v.showTimeOnHeader),v.formatHour&&(te=v.formatHour),v.formatDate&&(ee=v.formatDate),k=v.dateHeaderFormat?v.dateHeaderFormat:ee):(I={},f=80,m=oe,k=ee,D=ae);var n=e.events;n&&(j=n.onActivityClick,W=n.onMarkerClick,L=n.onGeneralMarkerClick)},this.zoomIn=function(){f*=1.1,this.clearGraphicElements(),this.build()},this.zoomOut=function(){f*=.9,this.clearGraphicElements(),this.build()},this.destroy=function(){this.clearGraphicElements(),delete r.update,delete r.zoomIn,delete r.zoomOut,delete r.destroy,delete r.stackedGantt},this.getData=function(){return O},this.getGeneralMarkers=function(){return c},this.getGeneralHighlights=function(){return d},this.build=function(){var e,t,n;O&&O.length?(!function(){var e=r[0].clientHeight;e=e?e-30*(!0===w)-30*(!0===_)-20:void 0;var t=ie("<div>",{class:"sg_container_wrapper"});r.append(t),i=ie("<div>",{class:"sg_container"}),t.append(i),o=ie("<div>",{class:"sg_header_container",css:{"margin-left":h}}),i.append(o),l=ie("<div>",{class:"sg_desc_container",css:{height:e||void 0,width:h}}),i.append(l),(u=ie("<div>",{class:"sg_val_container",css:{"grid-template-rows":"repeat(auto-fill, "+Q()+")",display:"grid",height:e||void 0}})).css("grid-template-rows","repeat(autofill, "+Q()+")"),i.append(u),n=u,n.bind("mousewheel DOMMouseScroll",function(e){(e=window.event||e).wheelDelta||e.detail||(e=e.originalEvent);var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));n.scrollLeft(n.scrollLeft()-40*t),e.preventDefault()}),w&&u.scroll(function(){H&&(H.remove(),H=null);var e=u.scrollLeft();o.scrollLeft(e);var t=A(e),n=Math.floor(e/f),r=g[n];H=N(r,null,e,t)});var n;l.scroll(function(){u.scrollTop(l.scrollTop())})}(),function(){var e,t,n=O.map(function(e){return{begin:function(e){var t=[];e.activities&&(t=t.concat(e.activities.map(function(e){return e.begin})));e.markers&&(t=t.concat(e.markers.map(function(e){return e.when})));e.thresholds&&(t=t.concat(e.thresholds.map(function(e){return e.begin})));if(!t.length)return;return t.reduce(function(e,t){return t<e?t:e})}(e),end:function(e){var t=[];e.activities&&(t=t.concat(e.activities.map(function(e){return e.end})));e.markers&&(t=t.concat(e.markers.map(function(e){return e.when})));e.thresholds&&(t=t.concat(e.thresholds.map(function(e){return e.end})));x&&t.push(x);if(!t.length)return;return t.reduce(function(e,t){return e<t?t:e})}(e)}}),r=n.map(function(e){return e.begin}).filter(function(e){return e}).concat(c.map(function(e){return e.when})).concat(d.map(function(e){return e.begin}));y&&r.push(y);e=r.length?new Date(r.reduce(function(e,t){return t<e?t:e})):new Date(E);!y&&T&&(e.getMinutes()<=10||50<=e.getMinutes())&&e.setHours(e.getHours()-1);e.setMinutes(0);var i=n.map(function(e){return e.end}).filter(function(e){return e}).concat(c.map(function(e){return e.when})).concat(d.map(function(e){return e.end}));x&&i.push(x);t=i.length?new Date(i.reduce(function(e,t){return e<t?t:e})):new Date(C);!x&&T&&(t.getMinutes()<=10||50<=t.getMinutes())&&t.setHours(t.getHours()+1);t.setMinutes(0),G={begin:e,end:t}}(),function(){w&&(M=[],a=ie("<div>",{class:"sg_date_header_container"}),o.append(a));s=ie("<div>",{class:"sg_time_header_container"}),o.append(s),g=function(){for(var e=[],t=new Date(G.begin);t<=G.end;t.setHours(t.getHours()+1))e.push(new Date(t));return e}(),p=g.length,g.forEach(function(e,t){var n,r;_&&(n=e,r=ie("<div>",{class:"sg_time_header_item",css:{width:f+"px"}}),s.append(r),r.html(te(n)),w&&r.attr("title",k(n))),!w||0!==t&&0!==e.getHours()||A(f*t)||M.push(N(e,t))})}(),e=M[M.length-1],t=Math.ceil(parseInt(e.css("left"))+e.outerWidth())+12,z=Math.max(p*f,t),O.forEach(function(e,t){var n,r,i,o,y,a,s,x,c=t%2==0;n=e,r=c,i=Q(),o=ie("<div>",{class:"sg_row_desc_container "+(r?"even":"odd"),css:{height:i,lineHeight:i}}),l.append(o),o.html(n.description),y=e,a=c,s=Q(),x=ie("<div>",{class:"sg_row_val_container "+(a?"even":"odd"),css:{height:s,lineHeight:s,width:z}}),u.append(x),y.activities.forEach(function(e){var t,n,r,i,o,a,s,c,u,l,d,h,f,p,g,v,m,b,w,_,k,D,H,M,E,C;n=x,r=y,k=F((t=e).begin,t.end),D=F(t.begin,G.begin),H=U(t),M=function(e){if(e.height)return e.height;var t=I[e.code];return t&&t.height?t.height:"20px"}(t),E=void 0!==(i=t).onClick?i.onClick:j,C=ie("<div>",{class:"sg_activity",css:{width:k,left:D,backgroundColor:H,height:M}}),n.append(C),E&&(C.click(function(){E(t,r,O)}),C.css("cursor","pointer")),o=t,a=C,s=r.description,c=U(o),u=o.description,l=s,d=Z((b=o).begin,!0)+" - "+Z(b.end,(w=b.begin,_=b.end,w=new Date(w).setHours(0,0,0,0),_=new Date(_).setHours(0,0,0,0),!(w===_))),h=u?u[0]:"?",f=q(),g=o,v=Math.round((g.end-g.begin)/1e3/60),m=Math.floor(v/60),p=Math.floor(m/24)+":"+("0"+m%24).substr(-2)+":"+("0"+v%60).substr(-2),J(a,f,c,u,d,p,h,l)}),y.thresholds&&y.thresholds.forEach(function(e){!function(e,t){if(e&&e.begin&&e.end){var n,r,i,o,a=(i=se((r=e).color?r.color:v&&v.thresholdColor?v.thresholdColor:"#000000"),o=.3,"rgba("+i.r+","+i.g+","+i.b+","+o+")"),s=(n=e).height?n.height:v&&v.thresholdHeight?v.thresholdHeight:"20px",c=F(e.begin,e.end),u=F(e.begin,G.begin),l={backgroundColor:a},d=ie("<div>",{class:"sg_threshold",css:{width:c,left:u,height:s}});t.append(d);var h=ie("<div>",{class:"sg_threshold_limit begin",css:l});d.append(h);var f=ie("<div>",{class:"sg_threshold_line",css:l});d.append(f);var p=ie("<div>",{class:"sg_threshold_limit end",css:l});d.append(p)}}(e,x)}),y.markers&&y.markers.forEach(function(e){var t,n,r,i,o,a,s,c,u,l,d;n=x,r=y,a=X(t=e),s=(o=t).height?o.height:"30px",c=Y(t),u=F(t.when,G.begin),l=void 0!==(i=t).onClick?i.onClick:W,d=ie("<div>",{class:"sg_marker",css:{width:a,height:s,left:u,backgroundColor:c}}),n.append(d),l&&(d.click(function(){l(t,r,O)}),d.css("cursor","pointer")),R(t,d,r.description)})}),function(){if(!c.length)return;c.forEach($)}(),function(){if(!d.length)return;d.forEach(B)}(),b||(b=!0,ie(window).on("resize",V))):(n=ie("<div>",{class:"sg_no_data",html:D}),r.append(n))};var ee=function(e){var t=e.getDate();return(t=("0"+t).slice(-2))+"/"+m[e.getMonth()]},te=function(e){var t=e.getHours();t=("0"+t).slice(-2);var n=e.getMinutes();return t+":"+(n=("0"+n).slice(-2))};function ne(e){var t=e.clone().show().css("visibility","hidden");re().append(t);var n={width:t.width(),height:t.height()};return t.remove(),n}function re(){var e=i.parentsUntil("body").last().parent();return ie(e)}}ie.fn.stackedGantt=function(e){var t=ie(this),r=new n(t);return(t.stackedGantt=r).clearOptions(),r.clearGraphicElements(),r.config(e),r.build(),t.update=function(e,t,n){r.update(e,t,n)},t.zoomIn=function(){r.zoomIn()},t.zoomOut=function(){r.zoomOut()},t.destroy=function(){r.destroy()},t.getData=function(){return r.getData()},t.getGeneralMarkers=function(){return r.getGeneralMarkers()},t.getGeneralHighlights=function(){return r.getGeneralHighlights()},t}}(jQuery);